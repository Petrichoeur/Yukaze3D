<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yukaze3D | Tableau de Flux</title>
    <link rel="stylesheet" href="css/dashboard.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Login Overlay -->
    <div id="login-overlay" class="login-overlay">
        <div class="login-container glass-panel">
            <div class="login-header">
                <i class="fas fa-lock"></i>
                <h2>Accès Protégé</h2>
                <p>Veuillez entrer le mot de passe pour accéder au tableau de bord</p>
            </div>
            <form id="login-form" class="login-form">
                <div class="input-group">
                    <i class="fas fa-key"></i>
                    <input type="password" id="password-input" placeholder="Mot de passe" autocomplete="off" required>
                </div>
                <p id="error-message" class="error-message"></p>
                <button type="submit" class="login-btn">
                    <i class="fas fa-unlock"></i> Accéder
                </button>
            </form>
            <a href="index.html" class="back-link"><i class="fas fa-arrow-left"></i> Retour au site</a>
        </div>
    </div>

    <canvas id="etherCanvas"></canvas>

    <nav class="glass-nav">
        <div class="logo">YUKAZE<span>3D</span> <span class="dashboard-label">Flux Monitor</span></div>
        <div class="nav-actions">
            <button id="refresh-btn" class="action-btn"><i class="fas fa-sync-alt"></i> Actualiser</button>
            <button id="clear-btn" class="action-btn danger"><i class="fas fa-trash"></i> Réinitialiser</button>
            <a href="index.html" class="action-btn"><i class="fas fa-home"></i> Retour</a>
        </div>
    </nav>

    <main class="dashboard-container">
        <header class="dashboard-header">
            <h1><i class="fas fa-chart-line"></i> Tableau de Bord Flux</h1>
            <p class="subtitle">Surveillance de l'activité en temps réel</p>
            <div class="last-update">Dernière mise à jour: <span id="last-update-time">--</span></div>
        </header>

        <!-- Summary Cards -->
        <section class="metrics-grid">
            <div class="metric-card glass-panel">
                <div class="metric-icon"><i class="fas fa-eye"></i></div>
                <div class="metric-content">
                    <span class="metric-value" id="total-visits">0</span>
                    <span class="metric-label">Visites Totales</span>
                </div>
            </div>
            <div class="metric-card glass-panel">
                <div class="metric-icon"><i class="fas fa-hand-pointer"></i></div>
                <div class="metric-content">
                    <span class="metric-value" id="total-interactions">0</span>
                    <span class="metric-label">Interactions</span>
                </div>
            </div>
            <div class="metric-card glass-panel">
                <div class="metric-icon"><i class="fas fa-images"></i></div>
                <div class="metric-content">
                    <span class="metric-value" id="gallery-views">0</span>
                    <span class="metric-label">Artefacts Vus</span>
                </div>
            </div>
            <div class="metric-card glass-panel">
                <div class="metric-icon"><i class="fas fa-music"></i></div>
                <div class="metric-content">
                    <span class="metric-value" id="music-plays">0</span>
                    <span class="metric-label">Musique Jouée</span>
                </div>
            </div>
        </section>

        <!-- Charts Section -->
        <section class="charts-section">
            <div class="chart-panel glass-panel">
                <h3><i class="fas fa-chart-bar"></i> Activité par Section</h3>
                <div class="chart-container" id="section-chart">
                    <div class="bar-chart" id="section-bars"></div>
                </div>
            </div>
            <div class="chart-panel glass-panel">
                <h3><i class="fas fa-star"></i> Artefacts Populaires</h3>
                <div class="chart-container">
                    <ul class="ranking-list" id="popular-projects"></ul>
                </div>
            </div>
        </section>

        <!-- Activity Timeline -->
        <section class="timeline-section glass-panel">
            <h3><i class="fas fa-stream"></i> Flux d'Activité Récent</h3>
            <div class="timeline-container" id="activity-timeline">
                <p class="empty-state">Aucune activité enregistrée</p>
            </div>
        </section>

        <!-- Social Links Stats -->
        <section class="social-section glass-panel">
            <h3><i class="fas fa-share-alt"></i> Clics sur Liens Sociaux</h3>
            <div class="social-stats" id="social-stats">
                <div class="social-stat">
                    <i class="fab fa-etsy"></i>
                    <span class="stat-value" id="clicks-etsy">0</span>
                    <span class="stat-label">Etsy</span>
                </div>
                <div class="social-stat">
                    <i class="fab fa-instagram"></i>
                    <span class="stat-value" id="clicks-insta">0</span>
                    <span class="stat-label">Instagram</span>
                </div>
                <div class="social-stat">
                    <i class="fab fa-tiktok"></i>
                    <span class="stat-value" id="clicks-tiktok">0</span>
                    <span class="stat-label">TikTok</span>
                </div>
                <div class="social-stat">
                    <i class="fab fa-discord"></i>
                    <span class="stat-value" id="clicks-discord">0</span>
                    <span class="stat-label">Discord</span>
                </div>
            </div>
        </section>

        <!-- Session Info -->
        <section class="session-section glass-panel">
            <h3><i class="fas fa-clock"></i> Informations de Session</h3>
            <div class="session-stats">
                <div class="session-item">
                    <span class="session-label">Première visite:</span>
                    <span class="session-value" id="first-visit">--</span>
                </div>
                <div class="session-item">
                    <span class="session-label">Dernière visite:</span>
                    <span class="session-value" id="last-visit">--</span>
                </div>
                <div class="session-item">
                    <span class="session-label">Sessions totales:</span>
                    <span class="session-value" id="total-sessions">0</span>
                </div>
            </div>
        </section>

        <!-- Shop Management Section -->
        <section class="shop-management-section glass-panel">
            <div class="shop-header">
                <h3><i class="fas fa-store"></i> Gestion de la Boutique</h3>
                <button id="add-shop-item-btn" class="action-btn primary">
                    <i class="fas fa-plus"></i> Ajouter un Article
                </button>
            </div>
            <p class="shop-description">Gerez les articles de votre boutique. Les modifications sont automatiquement synchronisees avec le site.</p>

            <div class="shop-items-grid" id="shop-items-grid">
                <p class="empty-state">Chargement des articles...</p>
            </div>
        </section>

        <!-- Shop Analytics Section (30-day rolling window) -->
        <section class="shop-analytics-section glass-panel">
            <div class="shop-analytics-header">
                <h3><i class="fas fa-chart-pie"></i> Analytiques Boutique</h3>
                <span class="analytics-period"><i class="fas fa-calendar-alt"></i> 30 derniers jours</span>
            </div>
            <p class="shop-analytics-description">Articles les plus consultes et cliques par vos visiteurs (retention: 1 mois glissant)</p>

            <!-- Summary Stats -->
            <div class="shop-analytics-summary" id="shop-analytics-summary">
                <div class="analytics-stat">
                    <i class="fas fa-eye"></i>
                    <span class="stat-value" id="shop-total-views">0</span>
                    <span class="stat-label">Vues</span>
                </div>
                <div class="analytics-stat">
                    <i class="fas fa-mouse-pointer"></i>
                    <span class="stat-value" id="shop-total-clicks">0</span>
                    <span class="stat-label">Clics</span>
                </div>
                <div class="analytics-stat">
                    <i class="fas fa-users"></i>
                    <span class="stat-value" id="shop-unique-visitors">0</span>
                    <span class="stat-label">Visiteurs uniques</span>
                </div>
                <div class="analytics-stat">
                    <i class="fas fa-box-open"></i>
                    <span class="stat-value" id="shop-articles-viewed">0</span>
                    <span class="stat-label">Articles consultes</span>
                </div>
            </div>

            <!-- Top Articles Ranking -->
            <div class="shop-top-articles">
                <h4><i class="fas fa-trophy"></i> Top Articles</h4>
                <ul class="shop-ranking-list" id="shop-top-articles-list">
                    <li class="empty-state">Chargement des donnees...</li>
                </ul>
            </div>
        </section>

        <!-- Music Settings Section -->
        <section class="music-settings-section glass-panel">
            <div class="music-settings-header">
                <h3><i class="fas fa-music"></i> Parametres Audio</h3>
            </div>
            <p class="music-settings-description">Configurez la musique de fond du site. Vous pouvez importer un fichier audio ou utiliser une URL externe.</p>

            <div class="music-settings-content">
                <!-- Current Music Info -->
                <div class="current-music-info">
                    <div class="music-info-label">Musique actuelle:</div>
                    <div class="music-info-value" id="current-music-name">theme.mp3 (par defaut)</div>
                </div>

                <!-- Music Source Selection -->
                <div class="music-source-tabs">
                    <button type="button" class="music-tab active" data-tab="url">
                        <i class="fas fa-link"></i> URL
                    </button>
                    <button type="button" class="music-tab" data-tab="upload">
                        <i class="fas fa-upload"></i> Importer
                    </button>
                </div>

                <!-- URL Input Tab -->
                <div class="music-tab-content active" id="music-url-tab">
                    <div class="form-group">
                        <label for="music-url-input"><i class="fas fa-globe"></i> URL de la musique</label>
                        <input type="url" id="music-url-input" placeholder="https://example.com/music.mp3">
                        <span class="form-hint">Formats supportes: MP3, WAV, OGG, M4A</span>
                    </div>
                </div>

                <!-- Upload Tab -->
                <div class="music-tab-content" id="music-upload-tab">
                    <div class="form-group">
                        <label><i class="fas fa-cloud-upload-alt"></i> Telecharger un fichier audio</label>
                        <div class="file-upload-container">
                            <input type="file" id="music-file-upload" accept="audio/mpeg,audio/wav,audio/ogg,audio/mp4,audio/x-m4a">
                            <label for="music-file-upload" class="file-upload-label">
                                <i class="fas fa-folder-open"></i>
                                <span id="music-upload-file-name">Choisir un fichier</span>
                            </label>
                            <span class="file-upload-hint">MP3, WAV, OGG, M4A - Max 10MB</span>
                        </div>
                        <div class="file-upload-progress" id="music-upload-progress">
                            <div class="progress-bar" id="music-progress-bar"></div>
                            <span class="progress-text" id="music-progress-text">Pret</span>
                        </div>
                    </div>
                </div>

                <!-- Volume Control -->
                <div class="volume-control-section">
                    <div class="form-group">
                        <label for="music-volume-slider"><i class="fas fa-volume-up"></i> Volume</label>
                        <div class="volume-slider-container">
                            <i class="fas fa-volume-off volume-icon-low"></i>
                            <input type="range" id="music-volume-slider" min="0" max="100" value="20">
                            <i class="fas fa-volume-up volume-icon-high"></i>
                            <span class="volume-value" id="volume-value-display">20%</span>
                        </div>
                    </div>
                </div>

                <!-- Audio Preview -->
                <div class="audio-preview-section">
                    <label><i class="fas fa-headphones"></i> Apercu</label>
                    <div class="audio-preview-container">
                        <audio id="music-preview" controls></audio>
                        <button type="button" id="test-music-btn" class="action-btn">
                            <i class="fas fa-play"></i> Tester
                        </button>
                    </div>
                </div>

                <!-- Actions -->
                <div class="music-settings-actions">
                    <button type="button" id="reset-music-btn" class="action-btn">
                        <i class="fas fa-undo"></i> Reinitialiser (theme.mp3)
                    </button>
                    <button type="button" id="save-music-settings-btn" class="action-btn primary">
                        <i class="fas fa-save"></i> Enregistrer
                    </button>
                </div>
            </div>
        </section>

        <!-- Shop Item Modal -->
        <div id="shop-modal" class="shop-modal-overlay">
            <div class="shop-modal-container glass-panel">
                <div class="shop-modal-header">
                    <h3 id="shop-modal-title"><i class="fas fa-edit"></i> Modifier l'article</h3>
                    <button class="close-shop-modal" id="close-shop-modal">&times;</button>
                </div>
                <form id="shop-item-form" class="shop-item-form">
                    <input type="hidden" id="shop-item-id">

                    <div class="form-group">
                        <label for="shop-item-titre"><i class="fas fa-tag"></i> Titre</label>
                        <input type="text" id="shop-item-titre" required placeholder="Nom de l'article">
                    </div>

                    <div class="form-group">
                        <label for="shop-item-description"><i class="fas fa-align-left"></i> Description</label>
                        <textarea id="shop-item-description" rows="3" placeholder="Description de l'article"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="shop-item-prix"><i class="fas fa-euro-sign"></i> Prix</label>
                            <input type="text" id="shop-item-prix" placeholder="45.00">
                        </div>

                        <div class="form-group">
                            <label for="shop-item-fichier"><i class="fas fa-image"></i> Image</label>
                            <input type="text" id="shop-item-fichier" required placeholder="image.jpg ou URL">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="shop-item-upload"><i class="fas fa-cloud-upload-alt"></i> Telecharger une nouvelle image</label>
                        <div class="file-upload-container">
                            <input type="file" id="shop-item-upload" accept="image/jpeg,image/png,image/gif,image/webp">
                            <label for="shop-item-upload" class="file-upload-label">
                                <i class="fas fa-folder-open"></i>
                                <span id="upload-file-name">Choisir un fichier</span>
                            </label>
                            <span class="file-upload-hint">JPEG, PNG, GIF, WEBP - Max 5MB</span>
                        </div>
                        <div class="file-upload-progress" id="upload-progress">
                            <div class="progress-bar" id="progress-bar"></div>
                            <span class="progress-text" id="progress-text">Pret</span>
                        </div>
                        <div class="image-preview-container" id="image-preview-container">
                            <img id="image-preview" src="" alt="Apercu de l'image">
                            <button type="button" class="remove-preview-btn" id="remove-preview-btn" title="Supprimer l'image">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="shop-item-etsy"><i class="fab fa-etsy"></i> Lien Etsy</label>
                        <input type="url" id="shop-item-etsy" placeholder="https://www.etsy.com/...">
                    </div>

                    <div class="form-actions">
                        <button type="button" id="cancel-shop-modal" class="action-btn">Annuler</button>
                        <button type="submit" class="action-btn primary"><i class="fas fa-save"></i> Enregistrer</button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <footer class="dashboard-footer">
        <p>Yukaze3D Flux Monitor &copy; 2026</p>
    </footer>

    <script src="scripts/dashboard.js"></script>
</body>
</html>
